<!DOCTYPE html>
<html>
<head>
    <title>Edmund's FOS Detector | Professional Analysis Suite</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', Arial, sans-serif;
            background-color: #0a1628;
            color: #ffffff;
            overflow-x: hidden;
            transition: background-color 0.3s;
        }
        
        /* Header with navigation */
        .header {
            background: rgba(10, 22, 40, 0.95);
            backdrop-filter: blur(10px);
            padding: 20px 50px;
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .logo-section {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .logo {
            width: 60px;
            height: 60px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid #00a8e8;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 24px;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(0, 168, 232, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(0, 168, 232, 0); }
            100% { box-shadow: 0 0 0 0 rgba(0, 168, 232, 0); }
        }
        
        .brand-text h1 {
            font-size: 18px;
            font-weight: 300;
            letter-spacing: 1.5px;
            margin-bottom: 2px;
        }
        
        .brand-text p {
            font-size: 11px;
            color: #00a8e8;
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }
        
        .header-controls {
            display: flex;
            gap: 20px;
            align-items: center;
        }
        
        /* Countdown Timer */
        .countdown-section {
            display: flex;
            align-items: center;
            gap: 15px;
            background: rgba(255, 255, 255, 0.05);
            padding: 10px 20px;
            border-radius: 8px;
            border: 1px solid rgba(0, 168, 232, 0.3);
        }
        
        .countdown-label {
            font-size: 12px;
            color: #00a8e8;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .countdown-timer {
            font-size: 16px;
            font-weight: bold;
            color: #00ff88;
            font-family: 'Courier New', monospace;
            min-width: 120px;
            text-align: center;
            text-shadow: 0 0 10px rgba(0, 255, 136, 0.5);
        }
        
        .history-btn, .voice-btn, .compare-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
        }
        
        .history-btn:hover, .voice-btn:hover, .compare-btn:hover {
            background: rgba(0, 168, 232, 0.2);
            border-color: #00a8e8;
        }
        
        /* Main Content */
        .main-content {
            margin-top: 100px;
            padding: 40px;
            max-width: 1200px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .section-title {
            font-size: 32px;
            font-weight: 300;
            margin-bottom: 10px;
            text-align: center;
            background: linear-gradient(45deg, #00a8e8, #00ff88);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: gradient 3s ease infinite;
        }
        
        @keyframes gradient {
            0%, 100% { filter: hue-rotate(0deg); }
            50% { filter: hue-rotate(30deg); }
        }
        
        .section-subtitle {
            font-size: 16px;
            color: #00a8e8;
            text-align: center;
            margin-bottom: 40px;
        }
        
        /* Input Section */
        .input-container {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 30px;
            margin-bottom: 30px;
            position: relative;
        }
        
        .input-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .input-label {
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #00a8e8;
        }
        
        .input-controls {
            display: flex;
            gap: 10px;
        }
        
        .clear-btn, .example-btn {
            background: transparent;
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: rgba(255, 255, 255, 0.7);
            padding: 5px 15px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s;
        }
        
        .clear-btn:hover, .example-btn:hover {
            border-color: #00a8e8;
            color: #00a8e8;
        }
        
        textarea {
            width: 100%;
            min-height: 150px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #ffffff;
            padding: 15px;
            font-size: 16px;
            font-family: inherit;
            border-radius: 4px;
            resize: vertical;
            transition: all 0.3s;
        }
        
        textarea:focus {
            outline: none;
            border-color: #00a8e8;
            background: rgba(255, 255, 255, 0.08);
            box-shadow: 0 0 20px rgba(0, 168, 232, 0.1);
        }
        
        .char-counter {
            text-align: right;
            color: rgba(255, 255, 255, 0.5);
            font-size: 12px;
            margin-top: 10px;
        }
        
        .analyze-button {
            background: linear-gradient(135deg, #00a8e8 0%, #0076a3 100%);
            color: #ffffff;
            border: none;
            padding: 15px 50px;
            font-size: 16px;
            text-transform: uppercase;
            letter-spacing: 2px;
            cursor: pointer;
            border-radius: 4px;
            transition: all 0.3s;
            display: block;
            margin: 0 auto;
            position: relative;
            overflow: hidden;
        }
        
        .analyze-button:before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }
        
        .analyze-button:hover:before {
            left: 100%;
        }
        
        .analyze-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(0, 168, 232, 0.4);
        }
        
        .analyze-button:disabled {
            background: rgba(255, 255, 255, 0.1);
            cursor: not-allowed;
            transform: none;
        }
        
        /* Loading State */
        .loading-container {
            display: none;
            text-align: center;
            padding: 40px;
        }
        
        .loading-container.active {
            display: block;
        }
        
        .spinner {
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            border-top: 3px solid #00a8e8;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Results Section */
        .results-container {
            display: none;
        }
        
        .results-container.active {
            display: block;
            animation: fadeIn 0.5s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .risk-meter {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 30px;
            margin-bottom: 30px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .risk-meter:before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(0, 168, 232, 0.1) 0%, transparent 70%);
            animation: rotate 10s linear infinite;
        }
        
        @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .risk-score {
            font-size: 72px;
            font-weight: bold;
            margin-bottom: 10px;
            position: relative;
            z-index: 1;
            transition: all 0.5s;
        }
        
        .risk-level {
            font-size: 24px;
            margin-bottom: 20px;
            position: relative;
            z-index: 1;
        }
        
        .risk-low { color: #00ff00; text-shadow: 0 0 20px rgba(0, 255, 0, 0.5); }
        .risk-moderate { color: #ffff00; text-shadow: 0 0 20px rgba(255, 255, 0, 0.5); }
        .risk-elevated { color: #ff9900; text-shadow: 0 0 20px rgba(255, 153, 0, 0.5); }
        .risk-high { color: #ff0000; text-shadow: 0 0 20px rgba(255, 0, 0, 0.5); }
        
        .analysis-depth-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .depth-label {
            color: #00a8e8;
            font-size: 14px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .depth-stars {
            display: flex;
            gap: 5px;
            font-size: 24px;
        }
        
        .star {
            color: rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }
        
        .star.filled {
            color: #ffd700;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
            animation: starPulse 0.5s ease;
        }
        
        .depth-text {
            color: rgba(255, 255, 255, 0.7);
            font-size: 12px;
            font-style: italic;
            min-width: 100px;
        }
        
        @keyframes starPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }
        
        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        .analysis-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
        }
        
        .analysis-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 25px;
            transition: all 0.3s;
        }
        
        .analysis-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 168, 232, 0.2);
            border-color: rgba(0, 168, 232, 0.3);
        }
        
        .card-title {
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #00a8e8;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .card-icon {
            width: 20px;
            height: 20px;
            display: inline-block;
        }
        
        .card-content {
            font-size: 14px;
            line-height: 1.6;
            color: rgba(255, 255, 255, 0.9);
        }
        
        .indicator-list {
            list-style: none;
        }
        
        .indicator-list li {
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .indicator-list li:before {
            content: '‚ñ∏';
            color: #00a8e8;
        }
        
        .indicator-list li:last-child {
            border-bottom: none;
        }
        
        .pattern-indicator {
            display: inline-block;
            padding: 4px 12px;
            background: rgba(0, 168, 232, 0.2);
            border: 1px solid #00a8e8;
            border-radius: 20px;
            font-size: 12px;
            margin: 4px;
            transition: all 0.3s;
        }
        
        .pattern-indicator.active {
            background: rgba(0, 168, 232, 0.4);
            transform: scale(1.1);
        }
        
        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
        }
        
        .action-btn {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 10px 25px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .action-btn:hover {
            background: rgba(0, 168, 232, 0.2);
            border-color: #00a8e8;
            transform: translateY(-2px);
        }
        
        /* History Modal */
        .history-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            padding: 20px;
            overflow-y: auto;
        }
        
        .history-modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .history-content {
            background: #0a1628;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 30px;
            max-width: 800px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .close-modal {
            background: transparent;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
        }
        
        .history-item {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 15px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .history-item:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: #00a8e8;
        }
        
        .history-date {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.5);
            margin-bottom: 5px;
        }
        
        .history-text {
            font-size: 14px;
            margin-bottom: 5px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .history-risk {
            font-size: 12px;
            color: #00a8e8;
        }
        
        /* Error State */
        .error-message {
            display: none;
            background: rgba(255, 0, 0, 0.1);
            border: 1px solid rgba(255, 0, 0, 0.3);
            color: #ff6666;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
            text-align: center;
        }
        
        .error-message.active {
            display: block;
            animation: shake 0.5s;
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }
        
        /* Mobile Responsive */
        @media (max-width: 768px) {
            .header {
                padding: 15px 20px;
            }
            
            .countdown-section {
                display: none;
            }
            
            .logo {
                width: 40px;
                height: 40px;
                font-size: 18px;
            }
            
            .brand-text h1 {
                font-size: 14px;
            }
            
            .header-controls {
                display: none;
            }
            
            .main-content {
                padding: 20px;
            }
            
            .section-title {
                font-size: 24px;
            }
            
            .risk-score {
                font-size: 48px;
            }
            
            .analysis-grid {
                grid-template-columns: 1fr;
            }
        }
        
        /* Voice Recording Animation */
        .voice-recording {
            display: none;
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: #ff0000;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            justify-content: center;
            align-items: center;
            animation: recording-pulse 1.5s infinite;
            cursor: pointer;
            z-index: 1000;
        }
        
        .voice-recording.active {
            display: flex;
        }
        
        @keyframes recording-pulse {
            0% { box-shadow: 0 0 0 0 rgba(255, 0, 0, 0.7); }
            70% { box-shadow: 0 0 0 20px rgba(255, 0, 0, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 0, 0, 0); }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-content">
            <div class="logo-section">
                <div class="logo">üîç</div>
                <div class="brand-text">
                    <h1>EDMUND'S FOS DETECTOR</h1>
                    <p>Professional Deception Analysis Suite</p>
                </div>
            </div>
            <div class="countdown-section">
                <div class="countdown-label">Edmund's Next Mastermind Starts in:</div>
                <div class="countdown-timer" id="countdownTimer">Loading...</div>
            </div>
            <div class="header-controls">
                <button class="history-btn" onclick="toggleHistory()">üìä History</button>
                <button class="voice-btn" onclick="toggleVoiceInput()">üé§ Voice</button>
                <button class="compare-btn" onclick="toggleCompareMode()">‚öñÔ∏è Compare</button>
            </div>
        </div>
    </div>

    <div class="main-content">
        <h2 class="section-title">AI-Powered Statement Analysis</h2>
        <p class="section-subtitle">Advanced Pattern Recognition & Behavioral Analysis</p>
        
        <div class="input-container">
            <div class="input-header">
                <div class="input-label">Enter Statement for Analysis</div>
                <div class="input-controls">
                    <button class="example-btn" onclick="loadExample()">Load Example</button>
                    <button class="clear-btn" onclick="clearInput()">Clear</button>
                </div>
            </div>
            <textarea 
                id="statementInput" 
                placeholder="Type or paste the statement you want to analyze..."
                maxlength="5000"
            ></textarea>
            <div class="char-counter">
                <span id="charCount">0</span> / 5000 characters
            </div>
        </div>
        
        <button class="analyze-button" id="analyzeBtn" onclick="analyzeStatement()">
            Analyze Statement
        </button>
        
        <div class="loading-container" id="loadingContainer">
            <div class="spinner"></div>
            <p>Performing advanced AI analysis...</p>
        </div>
        
        <div class="error-message" id="errorMessage"></div>
        
        <div class="results-container" id="resultsContainer">
            <div class="risk-meter">
                <div class="risk-score" id="riskScore" style="font-size: 72px;">0</div>
                <div class="risk-level" id="riskLevel" style="font-size: 24px; margin-top: 10px;">Deception Likelihood</div>
                <div class="score-explanation" id="scoreExplanation" style="margin-top: 15px; font-size: 14px; color: rgba(255,255,255,0.8); line-height: 1.5;"></div>
            </div>
            
            <div class="analysis-grid">
                <div class="analysis-card" style="grid-column: 1 / -1;">
                    <div class="card-title">
                        <span class="card-icon">üîç</span>
                        Deceptive Indicators
                    </div>
                    <div class="card-content">
                        <ul class="indicator-list" id="deceptiveIndicators" style="line-height: 1.8;"></ul>
                    </div>
                </div>
                
                <div class="analysis-card" style="grid-column: 1 / -1;">
                    <div class="card-title">
                        <span class="card-icon">ü§î</span>
                        Alternative Explanations
                    </div>
                    <div class="card-content" id="alternativeExplanations" style="text-align: left; line-height: 1.8; color: rgba(255,255,255,0.9);"></div>
                </div>
                
                <div class="analysis-card" style="grid-column: 1 / -1;">
                    <div class="card-title">
                        <span class="card-icon">üí¨</span>
                        Suggested Response Strategy
                    </div>
                    <div class="card-content" id="responseStrategy" style="text-align: left; line-height: 1.8; color: rgba(255,255,255,0.9);"></div>
                </div>
            </div>
            
            <div class="action-buttons">
                <button class="action-btn" onclick="startNewAnalysis()">
                    <span>üîÑ</span> New Analysis
                </button>
                <button class="action-btn" onclick="saveToHistory()">
                    <span>üíæ</span> Save Analysis
                </button>
                <button class="action-btn" onclick="exportAnalysis()">
                    <span>üì•</span> Export Report
                </button>
                <button class="action-btn" onclick="shareAnalysis()">
                    <span>üîó</span> Share Link
                </button>
            </div>
        </div>
    </div>
    
    <!-- History Modal -->
    <div class="history-modal" id="historyModal">
        <div class="history-content">
            <div class="history-header">
                <h2>Analysis History</h2>
                <button class="close-modal" onclick="toggleHistory()">‚úï</button>
            </div>
            <div id="historyList"></div>
        </div>
    </div>
    
    <!-- Voice Recording Indicator -->
    <div class="voice-recording" id="voiceIndicator" onclick="stopRecording()">
        <span style="color: white;">üé§</span>
    </div>

    <script>
        // Character counter
        const textarea = document.getElementById('statementInput');
        const charCount = document.getElementById('charCount');
        let currentAnalysis = null;
        let analysisHistory = JSON.parse(localStorage.getItem('fosHistory') || '[]');
        
        textarea.addEventListener('input', function() {
            charCount.textContent = this.value.length;
        });
        
        // API configuration
        const API_URL = window.location.hostname === 'localhost' 
            ? 'http://localhost:3000/api/analyze'
            : '/api/analyze';
        
        // Client-side deception analysis engine
        function performLocalAnalysis(statement) {
            const statementLower = statement.toLowerCase();
            const words = statementLower.split(/\s+/);
            const sentenceCount = statement.split(/[.!?]+/).filter(s => s.trim()).length;
            
            // Deception indicator patterns with recalibrated weights
            // Based on actual deception research, these patterns need context
            const indicators = {
                hedging: {
                    patterns: ['sort of', 'kind of', 'maybe', 'perhaps', 'possibly', 'roughly', 'approximately', 'seemingly', 'apparently', 'supposedly', 'basically', 'essentially'],
                    weight: 1.5,  // Reduced weight
                    found: [],
                    threshold: 1  // Lower threshold
                },
                qualifiers: {
                    patterns: ['just', 'only', 'simply', 'merely'],
                    weight: 0.3,  // Very low weight
                    found: [],
                    threshold: 3  // Lower threshold
                },
                overemphasis: {
                    patterns: ['to be honest', 'to tell the truth', 'believe me', 'trust me', 'i swear', 'swear to god', 'honestly', 'frankly'],
                    weight: 5,  // Increased from 4 - these are red flags
                    found: [],
                    threshold: 1  // Even one is suspicious
                },
                strongClaims: {
                    patterns: ['definitely', 'absolutely', 'certainly', 'obviously', 'clearly', 'undoubtedly', '100%', 'totally', 'completely'],
                    weight: 0.8,  // Lower weight
                    found: [],
                    threshold: 2  // Lower threshold
                },
                distancing: {
                    patterns: ['that person', 'that woman', 'that man', 'the person', 'one might', 'one would'],
                    weight: 4,  // Increased from 3 - strong indicator
                    found: [],
                    threshold: 1
                },
                tenseShift: {
                    patterns: ['was supposed to', 'were going to', 'had planned', 'meant to', 'tried to'],
                    weight: 3,  // More specific patterns
                    found: [],
                    threshold: 2
                },
                negation: {
                    patterns: ['not', 'never', "didn't", "don't", "wasn't", "weren't"],
                    weight: 0.3,  // Heavily reduced from 1 - too common
                    found: [],
                    threshold: 5  // Need many negations to matter
                },
                cognitive: {
                    patterns: ['think', 'thought', 'believe', 'guess', 'assume', 'suppose'],
                    weight: 0.5,  // Low weight - normal in opinions
                    found: [],
                    threshold: 2  // Lower threshold
                },
                emotional: {
                    patterns: ['feel', 'felt', 'upset', 'worried', 'anxious', 'nervous', 'scared', 'afraid'],
                    weight: 0.5,  // Low weight - emotions are normal
                    found: [],
                    threshold: 3
                },
                memoryIssues: {
                    patterns: ['forgot', "can't remember", "don't recall", 'memory is fuzzy', 'not sure if'],
                    weight: 4,  // New category - memory issues are suspicious
                    found: [],
                    threshold: 1
                },
                deflection: {
                    patterns: ['but anyway', 'that being said', 'regardless', 'to be fair', 'on the other hand'],
                    weight: 2,  // Reduced from 3 - some are conversational
                    found: [],
                    threshold: 2
                },
                vagueness: {
                    patterns: ['stuff', 'whatever', 'thing', 'something or other', 'whatnot', 'et cetera', 'and so on', 'and so forth'],
                    weight: 2.5,  // Slightly reduced from 3
                    found: [],
                    threshold: 2
                },
                minimization: {
                    patterns: ['only a little', 'not that much', 'barely any', 'hardly', 'just a bit', 'not really'],
                    weight: 3,  // New category - minimizing behavior
                    found: [],
                    threshold: 1
                }
            };
            
            // Analyze statement for indicators with threshold checking
            let totalScore = 0;
            let significantIndicators = 0;  // Count only significant findings
            let keyIndicators = [];
            
            for (const [key, indicator] of Object.entries(indicators)) {
                for (const pattern of indicator.patterns) {
                    const regex = new RegExp('\\b' + pattern.replace(/[.*+?^${}()|[\]\\]/g, '\\$&') + '\\b', 'gi');
                    const matches = statementLower.match(regex);
                    if (matches) {
                        indicator.found.push(...matches);
                    }
                }
                
                // Only add to score if threshold is met
                if (indicator.found.length >= indicator.threshold) {
                    totalScore += indicator.found.length * indicator.weight;
                    significantIndicators += indicator.found.length;
                }
            }
            
            // Build key indicators list - only for significant findings
            if (indicators.overemphasis && indicators.overemphasis.found.length >= indicators.overemphasis.threshold) {
                keyIndicators.push(`Trust-building language detected (${indicators.overemphasis.found.length} instance${indicators.overemphasis.found.length > 1 ? 's' : ''}): "${indicators.overemphasis.found[0]}"`);
            }
            if (indicators.memoryIssues && indicators.memoryIssues.found.length >= indicators.memoryIssues.threshold) {
                keyIndicators.push(`Memory inconsistencies noted: "${indicators.memoryIssues.found[0]}"`);
            }
            if (indicators.distancing && indicators.distancing.found.length >= indicators.distancing.threshold) {
                keyIndicators.push(`Distancing language detected: "${indicators.distancing.found[0]}"`);
            }
            if (indicators.hedging && indicators.hedging.found.length >= indicators.hedging.threshold) {
                keyIndicators.push(`Excessive hedging (${indicators.hedging.found.length} instances): "${indicators.hedging.found[0]}"`);
            }
            if (indicators.vagueness && indicators.vagueness.found.length >= indicators.vagueness.threshold) {
                keyIndicators.push(`Vague terminology: "${indicators.vagueness.found[0]}"`);
            }
            if (indicators.minimization && indicators.minimization.found.length >= indicators.minimization.threshold) {
                keyIndicators.push(`Minimization patterns: "${indicators.minimization.found[0]}"`);
            }
            if (indicators.strongClaims && indicators.strongClaims.found.length >= indicators.strongClaims.threshold) {
                keyIndicators.push(`Excessive certainty (${indicators.strongClaims.found.length} instances)`);
            }
            
            // Additional analysis factors
            const wordCount = words.length;
            const avgWordLength = words.reduce((sum, word) => sum + word.length, 0) / wordCount;
            
            // Check for specific high-risk patterns
            const hasContradiction = /but|however|although/.test(statementLower) && 
                                     /didn't|not|never/.test(statementLower) && 
                                     indicators.deflection.found.length >= 2;
            
            const hasTimeInconsistency = /yesterday|today|tomorrow|last week|next week/.test(statementLower) && 
                                         indicators.tenseShift.found.length >= indicators.tenseShift.threshold;
            
            const excessiveDetail = wordCount > 150 && sentenceCount > 5;  // Raised thresholds
            const tooShort = wordCount < 10;  // Very short responses can be evasive
            
            // Context-aware scoring adjustments
            if (hasContradiction) {
                totalScore += 8;  // Reduced from 15
                keyIndicators.push("Contradictory statements detected");
            }
            if (hasTimeInconsistency) {
                totalScore += 6;  // Reduced from 10
                keyIndicators.push("Timeline inconsistency");
            }
            if (excessiveDetail) {
                totalScore += 5;  // Reduced from 8
                keyIndicators.push("Unusually detailed response");
            }
            if (tooShort && significantIndicators > 0) {
                totalScore += 4;
                keyIndicators.push("Evasive brevity");
            }
            
            // Calculate deception likelihood score (1-10 scale)
            let deceptionScore;
            let scoreExplanation = "";
            
            if (significantIndicators === 0) {
                deceptionScore = 1 + Math.floor(Math.random() * 2);  // 1-2
                scoreExplanation = "The text appears straightforward with no significant deception markers.";
            } else if (totalScore < 5) {
                deceptionScore = 2 + Math.floor(totalScore / 2);  // 2-4
                scoreExplanation = "Minor linguistic patterns detected that are common in normal communication.";
            } else if (totalScore < 10) {
                deceptionScore = 4 + Math.floor(totalScore / 3);  // 4-6
                scoreExplanation = "Several patterns suggest possible uncertainty or evasiveness.";
            } else if (totalScore < 20) {
                deceptionScore = 6 + Math.floor(totalScore / 5);  // 6-8
                scoreExplanation = "Multiple deception indicators present that warrant careful consideration.";
            } else {
                deceptionScore = Math.min(8 + Math.floor(totalScore / 10), 10);  // 8-10
                scoreExplanation = "Strong deception patterns detected throughout the text.";
            }
            
            // Build deceptive indicators list
            let deceptiveIndicators = [];
            
            if (indicators.overemphasis.found.length > 0) {
                deceptiveIndicators.push(`<strong>Exaggeration/absolute claims:</strong> Uses phrases like "${indicators.overemphasis.found[0]}" to force belief`);
            }
            if (indicators.emotional && indicators.emotional.found.length >= 2) {
                deceptiveIndicators.push(`<strong>Overuse of emotional language:</strong> Multiple emotional appeals (${indicators.emotional.found.length} instances)`);
            }
            if (hasContradiction) {
                deceptiveIndicators.push(`<strong>Contradictions:</strong> Contains conflicting statements or logical inconsistencies`);
            }
            if (indicators.vagueness.found.length >= indicators.vagueness.threshold) {
                deceptiveIndicators.push(`<strong>Vagueness:</strong> Avoids specifics with terms like "${indicators.vagueness.found[0]}"`);
            }
            if (indicators.hedging.found.length >= 2) {
                deceptiveIndicators.push(`<strong>Excessive hedging:</strong> Overuse of qualifiers ("${indicators.hedging.found[0]}", "${indicators.hedging.found[1] || indicators.hedging.found[0]}")`);
            }
            if (indicators.distancing.found.length > 0) {
                deceptiveIndicators.push(`<strong>Distancing language:</strong> Psychological separation from claims`);
            }
            if (indicators.memoryIssues.found.length > 0) {
                deceptiveIndicators.push(`<strong>Memory lapses:</strong> Convenient forgetfulness with "${indicators.memoryIssues.found[0]}"`);
            }
            if (tooShort) {
                deceptiveIndicators.push(`<strong>Evasive brevity:</strong> Unusually short response avoiding detail`);
            }
            if (excessiveDetail) {
                deceptiveIndicators.push(`<strong>Over-explanation:</strong> Excessive unnecessary details (possible overcompensation)`);
            }
            
            if (deceptiveIndicators.length === 0) {
                deceptiveIndicators.push("No significant deceptive patterns detected");
            }
            
            // Generate alternative explanations
            let alternativeExplanations = [];
            
            if (deceptionScore <= 3) {
                alternativeExplanations.push("The communication style appears genuine and direct. Any minor patterns detected are likely part of the writer's natural expression.");
            } else if (deceptionScore <= 5) {
                alternativeExplanations.push("The patterns observed could reflect:");
                alternativeExplanations.push("‚Ä¢ Natural hesitation or uncertainty about complex topics");
                alternativeExplanations.push("‚Ä¢ Cultural or personal communication style differences");
                alternativeExplanations.push("‚Ä¢ Attempting to be polite or diplomatic rather than deceptive");
            } else if (deceptionScore <= 7) {
                alternativeExplanations.push("While concerning patterns exist, consider that the writer might be:");
                alternativeExplanations.push("‚Ä¢ Anxious or stressed, affecting their communication clarity");
                alternativeExplanations.push("‚Ä¢ Not a native speaker or unfamiliar with formal writing");
                alternativeExplanations.push("‚Ä¢ Genuinely uncertain rather than deliberately deceptive");
                alternativeExplanations.push("‚Ä¢ Using sales/marketing language that sounds manipulative but is standard practice");
            } else {
                alternativeExplanations.push("Even with strong indicators present, be aware that:");
                alternativeExplanations.push("‚Ä¢ High-pressure situations can cause defensive communication");
                alternativeExplanations.push("‚Ä¢ Some industries normalize exaggerated language");
                alternativeExplanations.push("‚Ä¢ The writer may be repeating someone else's deceptive information unknowingly");
            }
            
            // Generate response strategy
            let responseStrategy = [];
            
            if (deceptionScore <= 3) {
                responseStrategy.push("<strong>Low Risk - Open Collaboration:</strong>");
                responseStrategy.push("Respond with openness and trust. Engage directly with the content, ask clarifying questions as needed, and proceed with normal communication. No special precautions necessary.");
            } else if (deceptionScore <= 5) {
                responseStrategy.push("<strong>Low-Medium Risk - Trust but Verify:</strong>");
                responseStrategy.push("Maintain a friendly tone while seeking clarification on ambiguous points. Ask specific questions about any vague areas. Example: 'Could you provide more details about [specific claim]?' or 'What exactly do you mean by [vague term]?'");
            } else if (deceptionScore <= 7) {
                responseStrategy.push("<strong>Medium-High Risk - Cautious Engagement:</strong>");
                responseStrategy.push("Slow down the conversation. Request specific evidence or documentation for key claims. Use phrases like: 'That's interesting - could you share the data behind that?' or 'Before we proceed, I'd like to verify a few details.' Avoid making commitments until you've fact-checked independently.");
            } else {
                responseStrategy.push("<strong>High Risk - Protective Stance:</strong>");
                responseStrategy.push("Maintain professional distance. Document all interactions. Respond with: 'I'll need to review this carefully before responding' or 'Please provide verifiable documentation for these claims.' Consider involving legal counsel or other authorities if appropriate. Do not share sensitive information or make any commitments.");
            }
            
            // Additional metadata for analysis
            const metadata = {
                wordCount,
                indicatorCount: significantIndicators,
                totalScore: totalScore,
                analysisVersion: "3.0"
            };
            
            // Compile all results for return
            
            return {
                deceptionScore,
                scoreExplanation,
                deceptiveIndicators,
                alternativeExplanations: alternativeExplanations.join('<br>'),
                responseStrategy: responseStrategy.join('<br><br>'),
                metadata
            };
        }
        
        async function analyzeStatement() {
            const statement = document.getElementById('statementInput').value.trim();
            
            if (!statement) {
                showError('Please enter a statement to analyze.');
                return;
            }
            
            // Reset UI
            hideError();
            hideResults();
            showLoading();
            disableButton();
            
            // Simulate processing delay for realism
            setTimeout(() => {
                try {
                    const data = performLocalAnalysis(statement);
                    currentAnalysis = {
                        ...data,
                        statement,
                        timestamp: new Date().toISOString()
                    };
                    displayResults(data);
                    
                    // Auto-save to history
                    saveToHistory(true);
                } catch (error) {
                    showError('An error occurred during analysis. Please try again.');
                } finally {
                    hideLoading();
                    enableButton();
                }
            }, 1500 + Math.random() * 1000); // 1.5-2.5 second delay
        }
        
        function displayResults(data) {
            // Animate deception score (1-10)
            const scoreElement = document.getElementById('riskScore');
            const levelElement = document.getElementById('riskLevel');
            const explanationElement = document.getElementById('scoreExplanation');
            
            // Animate score from 0 to actual value
            animateValue(scoreElement, 0, data.deceptionScore, 1000, '/10');
            levelElement.textContent = 'Deception Likelihood';
            
            // Display score explanation
            setTimeout(() => {
                explanationElement.innerHTML = data.scoreExplanation;
                explanationElement.style.animation = 'fadeIn 0.5s';
            }, 500);
            
            // Apply color based on deception score
            scoreElement.className = 'risk-score';
            if (data.deceptionScore <= 3) {
                scoreElement.classList.add('risk-low');
            } else if (data.deceptionScore <= 5) {
                scoreElement.classList.add('risk-moderate');
            } else if (data.deceptionScore <= 7) {
                scoreElement.classList.add('risk-elevated');
            } else {
                scoreElement.classList.add('risk-high');
            }
            
            // Display deceptive indicators
            const indicatorsList = document.getElementById('deceptiveIndicators');
            indicatorsList.innerHTML = '';
            if (data.deceptiveIndicators && data.deceptiveIndicators.length > 0) {
                data.deceptiveIndicators.forEach((indicator, index) => {
                    setTimeout(() => {
                        const li = document.createElement('li');
                        li.innerHTML = indicator;  // Use innerHTML for formatting
                        li.style.animation = 'fadeIn 0.5s';
                        indicatorsList.appendChild(li);
                    }, 700 + (index * 100));
                });
            }
            
            // Display alternative explanations
            const altExplanations = document.getElementById('alternativeExplanations');
            if (altExplanations && data.alternativeExplanations) {
                setTimeout(() => {
                    altExplanations.innerHTML = data.alternativeExplanations;
                    altExplanations.style.animation = 'fadeIn 0.6s';
                }, 1200);
            }
            
            // Display response strategy
            const responseStrategy = document.getElementById('responseStrategy');
            if (responseStrategy && data.responseStrategy) {
                setTimeout(() => {
                    responseStrategy.innerHTML = data.responseStrategy;
                    responseStrategy.style.animation = 'fadeIn 0.6s';
                }, 1500);
            }
            
            showResults();
        }
        
        function animateValue(element, start, end, duration, suffix = '') {
            const range = end - start;
            const increment = range / (duration / 16);
            let current = start;
            
            const timer = setInterval(() => {
                current += increment;
                if ((increment > 0 && current >= end) || (increment < 0 && current <= end)) {
                    element.textContent = end + suffix;
                    clearInterval(timer);
                } else {
                    element.textContent = Math.round(current) + suffix;
                }
            }, 16);
        }
        
        function loadExample() {
            const examples = [
                "I definitely completed all the required tasks yesterday and sent them to you via email",
                "The project is basically done, I just need to maybe fix a few small things",
                "I'm telling you the truth, I swear I didn't know about the meeting",
                "To be honest, I think someone else might have made that mistake",
                "I completed the report last week and submitted it on time"
            ];
            const randomExample = examples[Math.floor(Math.random() * examples.length)];
            document.getElementById('statementInput').value = randomExample;
            charCount.textContent = randomExample.length;
        }
        
        function clearInput() {
            // Clear the input
            document.getElementById('statementInput').value = '';
            charCount.textContent = '0';
            
            // Hide all results
            const resultsContainer = document.getElementById('resultsContainer');
            if (resultsContainer) {
                resultsContainer.classList.remove('active');
            }
            
            // Clear error messages
            hideError();
            
            // Reset current analysis
            currentAnalysis = null;
        }
        
        function saveToHistory(silent = false) {
            if (!currentAnalysis) return;
            
            // Add to history
            analysisHistory.unshift(currentAnalysis);
            
            // Keep only last 20 analyses
            if (analysisHistory.length > 20) {
                analysisHistory = analysisHistory.slice(0, 20);
            }
            
            // Save to localStorage
            localStorage.setItem('fosHistory', JSON.stringify(analysisHistory));
            
            if (!silent) {
                showError('Analysis saved to history!');
                setTimeout(hideError, 2000);
            }
        }
        
        function toggleHistory() {
            const modal = document.getElementById('historyModal');
            modal.classList.toggle('active');
            
            if (modal.classList.contains('active')) {
                displayHistory();
            }
        }
        
        function displayHistory() {
            const historyList = document.getElementById('historyList');
            
            if (analysisHistory.length === 0) {
                historyList.innerHTML = '<p style="text-align: center; color: rgba(255,255,255,0.5);">No analysis history yet</p>';
                return;
            }
            
            historyList.innerHTML = analysisHistory.map((item, index) => `
                <div class="history-item" onclick="loadFromHistory(${index})">
                    <div class="history-date">${new Date(item.timestamp).toLocaleString()}</div>
                    <div class="history-text">${item.statement}</div>
                    <div class="history-risk">Deception Score: ${item.deceptionScore || item.riskScore}/10</div>
                </div>
            `).join('');
        }
        
        function loadFromHistory(index) {
            const item = analysisHistory[index];
            document.getElementById('statementInput').value = item.statement;
            charCount.textContent = item.statement.length;
            displayResults(item);
            toggleHistory();
            document.getElementById('resultsContainer').scrollIntoView({ behavior: 'smooth' });
        }
        
        function exportAnalysis() {
            if (!currentAnalysis) return;
            
            const report = `
FOS DETECTOR ANALYSIS REPORT
Generated: ${new Date().toLocaleString()}
================================

STATEMENT:
${currentAnalysis.statement}

RISK ASSESSMENT:
Risk Score: ${currentAnalysis.riskScore}%
Risk Level: ${currentAnalysis.riskLevel}
Confidence: ${currentAnalysis.confidence}%

KEY INDICATORS:
${currentAnalysis.keyIndicators.map(i => '‚Ä¢ ' + i).join('\n')}

ANALYSIS:
${currentAnalysis.analysis}

RECOMMENDATIONS:
${currentAnalysis.recommendations}

================================
Edmund's FOS Detector - Professional Analysis Suite
            `;
            
            const blob = new Blob([report], { type: 'text/plain' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `fos_analysis_${Date.now()}.txt`;
            a.click();
        }
        
        function shareAnalysis() {
            if (!currentAnalysis) return;
            
            const shareText = `FOS Analysis: Risk Score ${currentAnalysis.riskScore}% - ${currentAnalysis.riskLevel}`;
            const shareUrl = window.location.href;
            
            if (navigator.share) {
                navigator.share({
                    title: 'FOS Detector Analysis',
                    text: shareText,
                    url: shareUrl
                });
            } else {
                // Copy to clipboard
                navigator.clipboard.writeText(`${shareText}\n${shareUrl}`);
                showError('Link copied to clipboard!');
                setTimeout(hideError, 2000);
            }
        }
        
        // Voice input (using Web Speech API)
        let recognition = null;
        let isRecording = false;
        
        function toggleVoiceInput() {
            if (!('webkitSpeechRecognition' in window || 'SpeechRecognition' in window)) {
                showError('Voice input is not supported in your browser.');
                return;
            }
            
            if (isRecording) {
                stopRecording();
            } else {
                startRecording();
            }
        }
        
        function startRecording() {
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            recognition = new SpeechRecognition();
            recognition.continuous = true;
            recognition.interimResults = true;
            
            recognition.onstart = () => {
                isRecording = true;
                document.getElementById('voiceIndicator').classList.add('active');
            };
            
            recognition.onresult = (event) => {
                let finalTranscript = '';
                for (let i = event.resultIndex; i < event.results.length; i++) {
                    if (event.results[i].isFinal) {
                        finalTranscript += event.results[i][0].transcript;
                    }
                }
                if (finalTranscript) {
                    const currentText = document.getElementById('statementInput').value;
                    document.getElementById('statementInput').value = currentText + ' ' + finalTranscript;
                    charCount.textContent = document.getElementById('statementInput').value.length;
                }
            };
            
            recognition.onerror = () => {
                stopRecording();
                showError('Voice recognition error. Please try again.');
            };
            
            recognition.start();
        }
        
        function stopRecording() {
            if (recognition) {
                recognition.stop();
                isRecording = false;
                document.getElementById('voiceIndicator').classList.remove('active');
            }
        }
        
        function toggleCompareMode() {
            showError('Compare mode coming soon! This will allow you to analyze multiple statements side by side.');
            setTimeout(hideError, 3000);
        }
        
        function showLoading() {
            document.getElementById('loadingContainer').classList.add('active');
        }
        
        function hideLoading() {
            document.getElementById('loadingContainer').classList.remove('active');
        }
        
        function showResults() {
            document.getElementById('resultsContainer').classList.add('active');
            document.getElementById('resultsContainer').scrollIntoView({ behavior: 'smooth' });
        }
        
        function hideResults() {
            document.getElementById('resultsContainer').classList.remove('active');
        }
        
        function showError(message) {
            const errorElement = document.getElementById('errorMessage');
            errorElement.textContent = message;
            errorElement.classList.add('active');
        }
        
        function hideError() {
            document.getElementById('errorMessage').classList.remove('active');
        }
        
        function disableButton() {
            document.getElementById('analyzeBtn').disabled = true;
        }
        
        function enableButton() {
            document.getElementById('analyzeBtn').disabled = false;
        }
        
        // Allow Ctrl+Enter or Cmd+Enter to submit
        textarea.addEventListener('keydown', function(e) {
            if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
                analyzeStatement();
            }
        });
        
        // New Analysis function
        function startNewAnalysis() {
            // Clear input
            document.getElementById('statementInput').value = '';
            charCount.textContent = '0';
            
            // Hide results
            hideResults();
            hideError();
            
            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });
            
            // Focus on input
            document.getElementById('statementInput').focus();
        }
        
        // Countdown Timer
        function updateCountdown() {
            const now = new Date();
            
            // Get current time in Eastern Time
            const easternNow = new Date(now.toLocaleString("en-US", {timeZone: "America/New_York"}));
            const currentDay = easternNow.getDay();
            const currentHour = easternNow.getHours();
            const currentMinute = easternNow.getMinutes();
            
            // Calculate days until next Wednesday (3 = Wednesday)
            let daysUntilWednesday = (3 - currentDay + 7) % 7;
            
            // If it's Wednesday and past 9:00 AM ET, go to next Wednesday
            if (daysUntilWednesday === 0 && (currentHour > 9 || (currentHour === 9 && currentMinute > 0))) {
                daysUntilWednesday = 7;
            }
            
            // Create date for next mastermind
            const nextMastermind = new Date(now);
            nextMastermind.setDate(now.getDate() + daysUntilWednesday);
            
            // Set to 9:00 AM Eastern Time
            // We need to account for EDT (UTC-4) vs EST (UTC-5)
            const isDST = () => {
                const jan = new Date(now.getFullYear(), 0, 1).getTimezoneOffset();
                const jul = new Date(now.getFullYear(), 6, 1).getTimezoneOffset();
                return Math.max(jan, jul) !== now.getTimezoneOffset();
            };
            
            // 9 AM ET = 13:00 UTC (during EDT) or 14:00 UTC (during EST)
            const utcHour = isDST() ? 13 : 14;
            nextMastermind.setUTCHours(utcHour, 0, 0, 0);
            
            const diff = nextMastermind - now;
            
            if (diff > 0) {
                const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((diff % (1000 * 60)) / 1000);
                
                let countdownText = '';
                if (days > 0) {
                    countdownText = `${days}d ${hours}h ${minutes}m`;
                } else if (hours > 0) {
                    countdownText = `${hours}h ${minutes}m ${seconds}s`;
                } else {
                    countdownText = `${minutes}m ${seconds}s`;
                }
                
                document.getElementById('countdownTimer').textContent = countdownText;
                
                // Add urgency color
                const timerElement = document.getElementById('countdownTimer');
                if (days === 0 && hours < 1) {
                    timerElement.style.color = '#ff0000';
                    timerElement.style.textShadow = '0 0 10px rgba(255, 0, 0, 0.5)';
                } else if (days === 0) {
                    timerElement.style.color = '#ffff00';
                    timerElement.style.textShadow = '0 0 10px rgba(255, 255, 0, 0.5)';
                } else {
                    timerElement.style.color = '#00ff88';
                    timerElement.style.textShadow = '0 0 10px rgba(0, 255, 136, 0.5)';
                }
            } else {
                document.getElementById('countdownTimer').textContent = 'Starting Soon!';
            }
        }
        
        // Load history count on page load
        window.addEventListener('load', () => {
            if (analysisHistory.length > 0) {
                document.querySelector('.history-btn').textContent = `üìä History (${analysisHistory.length})`;
            }
            
            // Start countdown timer
            updateCountdown();
            setInterval(updateCountdown, 1000);
        });
    </script>
</body>
</html>